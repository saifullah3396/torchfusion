# @package _global_
defaults:
  - /args/model_args: "???"
  - /args/data_args: "???"

args:
  training_args:
    with_amp_inference: ${with_amp_inference}
  data_args:
    dataset_config_name: ${dataset_config_name}
    num_proc: 4
    cache_file_name: ${image_size_x}x${image_size_y}
    train_preprocess_augs:
      - name: PreprocessAug
        kwargs:
          rescale_size:
            - ${image_size_x}
            - ${image_size_y}
          key: image
    eval_preprocess_augs:
      - name: PreprocessAug
        kwargs:
          rescale_size:
            - ${image_size_x}
            - ${image_size_y}
          key: image
    # train_realtime_augs:
    #   - name: BasicImageAug
    #     kwargs:
    #       gray_to_rgb: True
    #       normalize: True
    #       mean:
    #         - 0.5
    #       std:
    #         - 0.5
    #       rescale_strategy:
    #         name: Rescale
    #         kwargs:
    #           size:
    #             - ${realtime_image_size_y}
    #             - ${realtime_image_size_x}
    #       key:
    #         - image
    # eval_realtime_augs:
    #   - name: BasicImageAug
    #     kwargs:
    #       gray_to_rgb: True
    #       normalize: True
    #       mean:
    #         - 0.5
    #       std:
    #         - 0.5
    #       rescale_strategy:
    #         name: Rescale
    #         kwargs:
    #           size:
    #             - ${realtime_image_size_y}
    #             - ${realtime_image_size_x}
    #       key:
    #         - image
    train_realtime_augs:
      - name: BasicImageAug
        kwargs:
          gray_to_rgb: True
          normalize: True
          random_hflip: True
          random_vflip: True
          mean:
            - 0.5
          std:
            - 0.5
          rescale_strategy:
            name: RandomResizedCrop
            kwargs:
              size:
                - 256
                - 256
              scale: ${as_tuple:0.08, 0.75}
          key:
            - image
    eval_realtime_augs:
      - name: BasicImageAug
        kwargs:
          gray_to_rgb: True
          normalize: True
          random_hflip: True
          random_vflip: True
          mean:
            - 0.5
          std:
            - 0.5
          rescale_strategy:
            name: RandomResizedCrop
            kwargs:
              size:
                - 256
                - 256
              scale: ${as_tuple:0.08, 0.75}
          key:
            - image
    data_loader_args:
      per_device_train_batch_size: ${bs}
      per_device_eval_batch_size: ${bs}

  analyzer_args:
    analyzer_output_dir: ${oc.env:TORCH_FUSION_OUTPUT_DIR}/analyzer/
    model_checkpoints: null
    tasks:
      generate_vae_features:
        task_type: GenerateVAEFeatures
        task_config:
          data_split: ${data_split}
  model_args:
    # checkpoint_state_dict_key: model
    config:
      fix_checkpoint: True

hydra:
  run:
    dir: ${args.analyzer_args.analyzer_output_dir}/${args.model_args.model_task}/${args.data_args.dataset_name}_${resolve_dir_name:${args.model_args.model_directory_name}}/${dataset_config_name}-${realtime_image_size_x}x${realtime_image_size_y}
  sweep:
    dir: ${args.analyzer_args.analyzer_output_dir}/${args.model_args.model_task}/
    subdir: ${args.data_args.dataset_name}_${args.model_args.name}_${resolve_dir_name:${args.model_args.config.model_type}}/
  output_subdir: hydra
  job:
    chdir: False

bs: 8
data_split: train
image_size_x: 1024
image_size_y: 1024
realtime_image_size_x: 1024
realtime_image_size_y: 1024
dataset_config_name: default
with_amp_inference: False